<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.106">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Collaboration on the hub tooling</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
  </style>

  <script src="index_files/libs/clipboard/clipboard.min.js"></script>
  <script src="index_files/libs/quarto-html/quarto.js"></script>
  <script src="index_files/libs/quarto-html/popper.min.js"></script>
  <script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
  <script src="index_files/libs/quarto-html/anchor.min.js"></script>
  <link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
  <link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body class="fullcontent">
<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">
<header id="title-block-header" class="quarto-title-block default">

<div class="quarto-title"><h1 class="title display-7">Collaboration on the hub tooling</h1></div></header>
<section id="preface" class="level2">
<h2 class="anchored" data-anchor-id="preface">Preface</h2>
<p>The principles and guidelines presented in this document are inspired from:</p>
<ul>
<li>communities / working groups in charge of defining widely used new standards, like the IETF and the W3C.</li>
<li>communities that have created and maintain universes of heavily interdependent packages, such as the <a href="https://github.com/tidyverse">tidyverse team</a>.</li>
<li>general good practice coding rules (e.g., semantic versioning).</li>
</ul>
</section>
<section id="introduction-goals-and-expectations" class="level2">
<h2 class="anchored" data-anchor-id="introduction-goals-and-expectations">Introduction: Goals and expectations</h2>
<div id="fig-concept-map" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="concept_map.svg" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 1: <a href="https://en.wikipedia.org/wiki/Concept_map">Concept map</a> of a modelling hub.</figcaption><p></p>
</figure>
</div>
<ul>
<li>Hub projects are complex, which present an challenge unusual for academics: developing while in production. Any breaking change in the infrastructure is made difficult by the fact that we don’t break the workflow of our contributors.</li>
<li>Software development is complex. There is no foolproof method to design a perfect piece of software at the first attempt. Even the most talented and experienced software developers make changes they regret afterwards and are forced to create breaking changes.</li>
</ul>
<p>Because of this double complexity, it is not likely that all teams will converge towards using the same package at the same time. But this also provides an opportunity: there is value in exploring independently radically different technological solutions to a given problems. One of the team might come across a solution that no other could have foreseen.</p>
<p>However, to keep a collaborative approach, where teams can adopt a solution developed by others, and where we can all build on each other’s work, there are some technical pre-requisites:</p>
<ul>
<li>We need to agree on a common basis for all our future work: data format standards and shared design guidelines.</li>
<li>We need to build modular building blocks so transition to a different approach is easy and doesn’t require changes throughout the ecosystem.</li>
</ul>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>As illustrated in <a href="#fig-concept-map">Figure&nbsp;1</a>, forecasts and the format they use is one of the most central part of hubs. It therefore needs to be the first point of discussion and agreement between hub teams. Subsequent changes should be done via a versioning system to avoid transmitting these breaking changes throughout hub tools.</p>
<section id="versioning" class="level3">
<h3 class="anchored" data-anchor-id="versioning">Versioning</h3>
<p>It is inevitable that data format will change over time as well. This is a somewhat common situation when new formats develop and there are plenty of examples to draw from to have a robust development process. <a href="https://www.w3.org/">The W3C</a> is one of the champions of this approach: SVG, HTML, CSS, WebExtensions, etc.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> In this framework, every proposed modifications go through a heavily codified selection process: First Public Working Draft, Revision of the Working Draft, Candidate Recommendation, Proposed Recommendation, Recommendation (illustrated in <a href="#fig-w3c-process">Figure&nbsp;2</a>, from <a href="https://www.w3.org/2021/Process-20211102/">the W3C Process Document</a>). You can see a live example by visiting the CSS Working Group Current Work page: <a href="https://www.w3.org/Style/CSS/current-work" class="uri">https://www.w3.org/Style/CSS/current-work</a>.</p>
<div id="fig-w3c-process" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="w3c_process.svg" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Figure 2: Detail of the W3C process to validate a new standard.</figcaption><p></p>
</figure>
</div>
<p>This complex and somewhat rigid framework is necessary because of the billions of users impacted by the recommendations. We might however want a simpler system for the hub. Such a simpler model can be seen in the json schema specification, where stable versions and draft specifications coexist.</p>
<p>All hub teams should agree on a stable models and submit all proposed changes for consideration to the other teams. If the proposed change seem desirable, it should be added to the draft for the next version.</p>
<p>Each package can then specify with which version of the data format it is compatible.</p>
</section>
<section id="individual-forecasts-vs-aggregated-forecasts-format" class="level3">
<h3 class="anchored" data-anchor-id="individual-forecasts-vs-aggregated-forecasts-format">Individual forecasts vs aggregated forecasts format</h3>
<p>To reduce confusion and maintenance load, individual forecasts and aggregated forecasts (e.g., as output by <code>covidHubUtils::load_forecasts()</code>) should have the same format. Additional columns could potentially be added to aggregated forecasts but the columns should always be a superset of the columns of individual forecasts.</p>
<p>This allows tools to be used directly on individual forecasts, which may be desirable for forecasters and hub maintainers in many situations.</p>
</section>
</section>
<section id="guidelines-for-universe" class="level2">
<h2 class="anchored" data-anchor-id="guidelines-for-universe">Guidelines for universe</h2>
<section id="modular-approach" class="level3">
<h3 class="anchored" data-anchor-id="modular-approach">Modular approach</h3>
<p>To ensure each team can easily swap individual pieces of their infrastructure, it is important to ensure that the universe is modular. Each package should focus on a single task (defined beforehand).</p>
</section>
<section id="avoiding-redundancy" class="level3">
<h3 class="anchored" data-anchor-id="avoiding-redundancy">Avoiding redundancy</h3>
<p>On a similar note, to avoid that changes in one piece of the infrastructure ripple throughout the whole universe, overlap between packages should be limited as much as possible.</p>
<p>The current hub infrastructure gives a good example of the maintenance overhead due to overlap and redundancy across packages. As of 2021, the submissions are checked for validated in the point during the pipeline: during the submission process, when loaded with <code>covidHubUtils::load_forecasts()</code>, when uploaded to zoltar. This means that any change in the data format requires changes in each one of the 3 packages. Ultimately, it makes it more difficult to try to modify &amp; improve the infrastructure.</p>
</section>
<section id="designing-general-tools" class="level3">
<h3 class="anchored" data-anchor-id="designing-general-tools">Designing general tools</h3>
<p>Since it can be difficult to predict how the other hubs will use the packages your team designed, it is good practice to start with a very streamlined architecture, with few features. It is easier to add features &amp; complexity later down the line once other hubs agreed to the proposed new features than to try and simplify an existing package.</p>
<p>If the tool can be made usable outside the context of hubs, it is even better. Users are the most valuable and hardest to get feature of research software. More users means more bugs uncovered, which is crucial, since research software is often poorly tested.</p>
</section>
</section>
<section id="guidelines-for-individual-packages" class="level2">
<h2 class="anchored" data-anchor-id="guidelines-for-individual-packages">Guidelines for individual packages</h2>
<section id="inputs" class="level3">
<h3 class="anchored" data-anchor-id="inputs">Inputs</h3>
<p>Whenever possible, the first input should be the data format defined in <a href="#data">data</a>.</p>
<p>There should be tests ensuring that all functions return the same output when fed with <code>data.frame</code>, <code>tibble</code> or <code>data.table</code> since users might prefer to use one or the other in the other steps of their workflow.</p>
</section>
<section id="outputs" class="level3">
<h3 class="anchored" data-anchor-id="outputs">Outputs</h3>
<p>Whenever possible, the output should be the data format defined in <a href="#data">data</a>. Using the same format in input &amp; output makes it easy for users to use functions in a pipeline with a previously unanticipated order.</p>
</section>
<section id="lifecycle-versioning" class="level3">
<h3 class="anchored" data-anchor-id="lifecycle-versioning">Lifecycle &amp; versioning</h3>
<section id="semantic-versioning" class="level4">
<h4 class="anchored" data-anchor-id="semantic-versioning">Semantic versioning</h4>
<p>It is likely that many packages from the universe will depend on others packages from the universe, possibly maintained by another team. It is therefore important to be able to identify breaking changes easily. The most common pattern for this is to use <a href="https://semver.org/">semantic versioning</a>, where breaking changes are signified by the major version increase.</p>
</section>
<section id="sec-revdeps" class="level4">
<h4 class="anchored" data-anchor-id="sec-revdeps">Reverse dependency checking</h4>
<p>Even with a modular structure, packages will be inevitably deeply interconnected. This poses challenges regarding release timing. The tidyverse for example already had to deal with complex issue on this matter:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/paste-4C7C6C13.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Comment from Jenny Bryan on the reprex issue tracker: ‘The dev version of reprex depends on the dev version of callr. So callr needs to submit first. But the dev version of callr depends on the dev version of processx. So processx needs to update first. And it has been stuck at CRAN for months.’. Source: <a href="https://github.com/tidyverse/reprex/issues/171#issuecomment-360996216" class="uri">https://github.com/tidyverse/reprex/issues/171#issuecomment-360996216</a></figcaption><p></p>
</figure>
</div>
<p>To make sure updates are published in the correct order, all packages in the universe should be set up for reverse dependency checking. This service is provided for free by CRAN but since we did not decide yet if all packages should be on CRAN, we should also set up our own reverse dependency checking infrastructure.</p>
</section>
<section id="sec-advertising" class="level4">
<h4 class="anchored" data-anchor-id="sec-advertising">Update adversiting</h4>
<p>Additionally, to make sure breaking changes are promptly addressed in reverse dependencies, all new versions should be loudly announced to all other teams. An issue way to do this would be to create a dedicated slack channel with subscriptions to the relevant repository RSS feeds.</p>
</section>
<section id="release-cadence" class="level4">
<h4 class="anchored" data-anchor-id="release-cadence">Release cadence</h4>
<p>??</p>
<p>See discussion at <a href="https://discuss.ropensci.org/t/release-cadence-how-do-developers-estimate-when-a-new-release-is-due/2861" class="uri">https://discuss.ropensci.org/t/release-cadence-how-do-developers-estimate-when-a-new-release-is-due/2861</a></p>
</section>
</section>
</section>
<section id="questions-for-scope-assessment" class="level2">
<h2 class="anchored" data-anchor-id="questions-for-scope-assessment">Questions for scope assessment</h2>
<ul>
<li>Could this package be accepted by CRAN in theory (even if you don’t go through the actual submission process)?</li>
<li>Would this package work without any changes in someone started a hub in a new region (e.g., Africa or South America)?</li>
<li>To how many concepts or processes from <a href="#fig-concept-map">Figure&nbsp;1</a> does this package relate? The answer should probably be one in most cases.</li>
</ul>
</section>
<section id="collaboration-communication" class="level2">
<h2 class="anchored" data-anchor-id="collaboration-communication">Collaboration &amp; communication</h2>
<section id="centralized-organisation" class="level3">
<h3 class="anchored" data-anchor-id="centralized-organisation">Centralized organisation</h3>
<p>To ensure constant quality across the universe and facilitate infrastructure building (e.g. <a href="#sec-revdeps">Section&nbsp;5.3.2</a>, <a href="#sec-advertising">Section&nbsp;5.3.3</a>), it might make sense to group all packages in a single GitHub organisation.</p>
</section>
<section id="governance" class="level3">
<h3 class="anchored" data-anchor-id="governance">Governance</h3>
<p>Complex projects with many moving parts and numerous collaborators need a clear governance structure. If two collaborators disagree and cannot resolve their disagreement through a discussion, what should be done? In a typical academic article framework, the first author is usually allowed to get the final say in these matters. But this system cannot easily be transposed here.</p>
<p>First of all, in case of a disagree, there is nothing wrong with agreeing to move in different directions for this specific piece of infrastructure. As mentioned in the introduction of this document, there is value in exploring different alternatives, as long as we make sure we remain compatible.</p>
<p>However, this kind of split should remain limited because it takes off time from an already very time-limited team. Open-source projects usually deal with this situation by having a clear governance model in a public document. A short and simple example of a governance model comes from the tidyverse and ggplot2: <a href="https://github.com/tidyverse/ggplot2/blob/main/GOVERNANCE.md" class="uri">https://github.com/tidyverse/ggplot2/blob/main/GOVERNANCE.md</a>.</p>
</section>
<section id="monthly-meetings" class="level3">
<h3 class="anchored" data-anchor-id="monthly-meetings">Monthly meetings</h3>
<p>To ensure communication stays active, we should book a slot for monthly meetings. Additionally, to ensure equal footing of all teams or to maintain engagement, a rotating schedule should be established. Each team will be responsible for presentation one existing or planned piece of infrastructure. This should facilitate exchange of workflow pieces between teams and facilitate communication and identification of possible incompatibility.</p>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>The IETF is another champion and delivered standards like the HTTP protocol.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->


</body></html>